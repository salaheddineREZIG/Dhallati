{% extends 'layout.html' %}

{% block title %}Lost and Found{% endblock %}

{% block main %}
<div class="container py-5">
    <div class="text-center mb-5">
        <h1 class="display-4">Lost and Found</h1>
    </div>
    <div class="row justify-content-center text-center mb-4">
        <div class="col-lg-8 col-md-10">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h2 class="card-title text-center">Report Item</h2>
                    <form method="POST" enctype="multipart/form-data" id="lost-form" class="mt-4">
                        {{ form.hidden_tag() }}
                        {% for subfield in form.report_type %}
                            <div class="form-check ">
                                {{ subfield.label(class="form-check-label") }}
                                {{ subfield(class="form-check-input") }}
                            </div>
                        {% endfor %}
                        <div class="form-check form-switch mb-3 mt-3">
                            {{ form.is_anonymous(class="form-check-input", type="checkbox", role="switch") }}
                            {{ form.is_anonymous.label(class="form-check-label") }}
                        </div>

                        <div class="mb-3">
                            {{ form.name.label(class="form-label") }}
                            {{ form.name(class="form-control") }}
                        </div>

                        <div class="mb-3">
                            {{ form.description.label(class="form-label") }}
                            {{ form.description(class="form-control") }}
                        </div>

                        <div class="mb-3">
                            {{ form.category.label(class="form-label") }}
                            {{ form.category(class="form-select") }}
                        </div>

                        <div class="mb-3">
                            {{ form.location_reported.label(class="form-label") }}
                            {{ form.location_reported(class="form-control") }}
                        </div>

                        <div class="mb-3">
                            {{ form.event_datetime.label(class="form-label") }}
                            <input type="datetime-local" class="form-control" 
                                   id="{{ form.event_datetime.id }}" 
                                   name="{{ form.event_datetime.name }}" 
                                   value="{{ form.event_datetime.data.strftime('%Y-%m-%dT%H:%M') if form.event_datetime.data else '' }}">
                        </div>
                        

                        <div class="mb-3">
                            {{ form.images.label(class="form-label") }}
                            {{ form.images(class="form-control") }}
                        </div>

                        <div class="mb-3">
                            {{ form.additional_details.label(class="form-label") }}
                            {{ form.additional_details(class="form-control") }}
                        </div>

                        <div class="mb-3">
                            {{ form.contact_info.label(class="form-label") }}
                            {{ form.contact_info(class="form-control") }}
                        </div>

                        <div class="d-grid">
                            {{ form.submit(class="btn btn-primary btn-lg") }}
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="row text-center mb-4">
        <div class="col-md-6">
            <a href="#" class="btn btn-outline-secondary btn-lg w-100 mb-3">Browse Lost Items</a>
        </div>
        <div class="col-md-6">
            <a href="#" class="btn btn-outline-secondary btn-lg w-100 mb-3">Browse Found Items</a>
        </div>
    </div>
</div>

<script type="text/javascript">
    document.addEventListener("DOMContentLoaded", async function() {
        document.getElementById("lost-form").addEventListener("submit", async function(event) {
            event.preventDefault();

            let formData = new FormData(event.target); 
            formData.append("csrf_token", "{{ csrf_token }}");
            let response = await fetch("/lost_and_found/api/lost", {
                method: "POST",
                body: formData,
            });
            if (!response.ok) {
                alert("Error: " + response.statusText);
                return;
            }
            let data = await response.json();
            console.log(data);

            document.getElementById("flash-message").setAttribute("class", "alert alert-success alert-dismissible fade show");
            document.getElementById("flash-message").setAttribute("role", "alert");
            document.getElementById("flash-message").innerHTML = "Your item has been reported.";


            event.target.reset();
        });

    });
</script>
{% endblock %}
